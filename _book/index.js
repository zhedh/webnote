/**
 * @param {number} n
 * @param {number[][]} relations
 * @return {number}
 */
var minimumSemesters = function (n, relations) {
  // const indegree = []
  const outdegree = []

  for (let i = 0; i < relations.length; i++) {
    const [p, n] = relations[i]

    // indegree[n] ? indegree[n].push(p) : (indegree[n] = [p])
    outdegree[p] ? outdegree[p].push(n) : (outdegree[p] = [n])
  }

  const counts = []
  let path = []

  function dfs(i, n, depth) {
    if (counts[i] === -1 || path.includes(i)) {
      path.push(i)
      counts[n] = -1
      return
    }

    path.push(i)

    if (counts[i] > 0) {
      counts[n] = Math.max(depth + counts[i], counts[n] || -1)
      return
    }

    if (!outdegree[i] || outdegree[i].length === 0) {
      counts[n] = Math.max(depth + 1, counts[n] || -1)
      return
    }

    for (let j = 0; j < outdegree[i].length; j++) {
      dfs(outdegree[i][j], n, depth + 1)
      path.pop()
    }
  }

  for (let i = 1; i <= n; i++) {
    if (counts[i] === -1) return -1
    dfs(i, i, 0)
    path.pop()
  }

  // console.log('counts: ', counts)

  let max = counts[1]
  for (let i = 1; i < counts.length; i++) {
    if (counts[i] === -1) return -1
    max = Math.max(counts[i], max)
  }

  return max
}

console.log(
  minimumSemesters(27, [
    [22, 25],
    [6, 10],
    [13, 22],
    [10, 11],
    [22, 27],
    [1, 4],
    [1, 21],
    [10, 21],
    [1, 8],
    [16, 18],
    [6, 15],
    [14, 19],
    [2, 14],
    [6, 25],
    [1, 17],
    [4, 20],
    [14, 17],
    [10, 25],
    [13, 19],
    [1, 11],
    [7, 22],
    [16, 22],
    [10, 24],
    [1, 7],
    [2, 19],
    [5, 26],
    [4, 18],
    [7, 18],
    [3, 22],
    [6, 24],
    [17, 24],
    [2, 9],
    [7, 26],
    [5, 6],
    [3, 8],
    [11, 18],
    [15, 24],
    [2, 21],
    [14, 23],
    [11, 22],
    [6, 8],
    [10, 15],
    [7, 27],
    [17, 26],
    [2, 6],
    [16, 17],
    [13, 27],
    [8, 9],
    [12, 20],
    [3, 20],
    [13, 14],
    [1, 25],
    [5, 24],
    [22, 26],
    [2, 10],
    [21, 22],
    [6, 17],
    [2, 13],
    [19, 20],
    [5, 16],
    [9, 21],
    [21, 27],
    [8, 11],
    [4, 12],
    [21, 24],
    [12, 14],
    [2, 15],
    [10, 22],
    [14, 26],
    [24, 26],
    [12, 17],
    [3, 15],
    [7, 24],
    [15, 23],
    [8, 17],
    [4, 15],
    [3, 18],
    [11, 13],
    [15, 27],
    [18, 25],
    [2, 3],
    [3, 13],
    [10, 27],
    [1, 5],
    [20, 27],
    [12, 18],
    [4, 24],
    [5, 14],
    [8, 14],
    [21, 26],
    [9, 15],
    [23, 25],
    [2, 26],
    [3, 21],
    [4, 19],
    [16, 27],
    [7, 11],
    [13, 17],
    [11, 12],
    [13, 21],
    [2, 16],
    [2, 24],
    [2, 18],
    [9, 11],
    [6, 14],
    [20, 24],
    [1, 26],
    [14, 24],
    [10, 20],
    [3, 19],
    [8, 10],
    [23, 27],
    [6, 26],
    [15, 19],
    [6, 21],
    [4, 7],
    [13, 24],
    [6, 18],
    [6, 9],
    [2, 23],
    [14, 18],
    [1, 18],
    [9, 18],
    [4, 21],
    [4, 25],
    [14, 22],
    [7, 19],
    [18, 26],
    [4, 17],
    [19, 21],
    [16, 23],
    [9, 16],
    [9, 17],
    [8, 12],
    [3, 4],
    [7, 15],
    [2, 5],
    [11, 16],
    [12, 15],
    [12, 27],
    [23, 24],
    [12, 21],
    [18, 27],
    [9, 22],
    [13, 26],
    [1, 6],
    [4, 14],
    [17, 18],
    [19, 25],
    [5, 13],
    [14, 27],
    [5, 27],
    [4, 27],
    [15, 17],
    [10, 12],
    [9, 13],
    [5, 9],
    [2, 25],
    [7, 13],
    [2, 17],
    [5, 20],
    [1, 10],
    [25, 27],
    [18, 24],
    [16, 21],
    [1, 16],
    [15, 21],
    [1, 23],
    [4, 10],
    [7, 10],
    [9, 25],
    [6, 19],
    [1, 20],
    [16, 24],
    [1, 12],
    [16, 20],
    [21, 25],
    [3, 6],
    [11, 27],
    [8, 16],
    [26, 27],
    [11, 14],
    [10, 23],
    [17, 25],
    [15, 16],
    [3, 27],
    [20, 26],
    [24, 25],
    [7, 23],
    [20, 22],
    [10, 19],
    [10, 16],
    [2, 27],
    [5, 17],
    [3, 25],
    [18, 22],
    [15, 18],
    [13, 18],
    [5, 12],
    [14, 16],
    [3, 10],
    [4, 26],
    [11, 17],
    [9, 23],
    [2, 4],
    [19, 22],
    [12, 16],
    [8, 15],
    [19, 27],
    [6, 22],
    [11, 24],
    [11, 15],
    [8, 24],
    [16, 19],
    [6, 23],
    [10, 18],
    [16, 25],
    [10, 13],
    [15, 20],
    [15, 22],
    [10, 26],
    [20, 25],
    [12, 23],
    [1, 24],
    [11, 20],
    [18, 21],
    [9, 24],
    [12, 13],
    [1, 15],
    [8, 21],
    [14, 15],
    [11, 23],
    [4, 11],
    [5, 22],
    [3, 5],
    [10, 17],
    [7, 17],
    [7, 20],
    [6, 11],
    [5, 25],
    [18, 20],
    [4, 6],
    [17, 21],
    [2, 22],
    [2, 20],
    [8, 23],
    [18, 23],
    [24, 27],
    [3, 26],
    [21, 23],
    [17, 20],
    [3, 9],
    [8, 20],
    [8, 25],
    [7, 8],
    [20, 23],
    [12, 26],
    [17, 19],
    [5, 15],
    [8, 13],
    [1, 13],
    [7, 14],
    [9, 26],
    [8, 18],
    [3, 23],
    [7, 9],
    [17, 22],
    [5, 23],
    [4, 22],
    [16, 26],
    [3, 11],
    [3, 16],
    [11, 21],
    [3, 17],
    [7, 16],
    [12, 19],
    [13, 25],
    [3, 7],
    [9, 19],
    [8, 27],
    [2, 7],
    [19, 23],
    [4, 5],
    [17, 23],
    [13, 23],
    [18, 19],
    [8, 22],
    [14, 21],
    [10, 14],
    [9, 20],
    [6, 13],
    [14, 20],
    [6, 16],
    [1, 27],
    [5, 10],
    [1, 14],
    [1, 2],
    [1, 19],
    [13, 16],
    [4, 16],
    [2, 8],
    [6, 27],
    [12, 24],
    [14, 25],
    [9, 27],
    [3, 14],
    [6, 12],
    [12, 22],
    [7, 25],
    [3, 12],
    [9, 14],
    [6, 7],
    [25, 26],
    [4, 13],
    [19, 26],
    [1, 22],
    [8, 26],
    [23, 26],
    [2, 11],
    [5, 19],
    [19, 24],
    [1, 3],
    [22, 23],
    [15, 26],
    [9, 12],
    [5, 21],
    [15, 25],
    [2, 12],
    [6, 20],
    [3, 24],
    [8, 19],
    [4, 8],
    [4, 9],
    [17, 27],
    [7, 21],
    [5, 18],
    [11, 25],
    [7, 12],
    [4, 23],
    [9, 10],
    [11, 19],
    [1, 9],
    [20, 21],
    [13, 15],
    [5, 11],
    [22, 24],
    [11, 26],
    [5, 8],
    [5, 7],
    [12, 25],
    [13, 20],
  ])
)

// 25 [[5,10],[11,14],[21,22],[16,19],[21,25],[6,18],[1,9],[4,7],[10,23],[5,14],[9,18],[18,21],[11,22],[1,15],[1,2],[5,18],[7,20],[2,23],[12,13],[9,14],[10,16],[11,21],[5,12],[2,24],[8,17],[15,17],[10,13],[11,16],[20,22],[7,11],[9,15],[16,22],[18,20],[19,22],[10,18],[3,20],[16,25],[10,15],[1,23],[13,16],[23,25],[1,8],[4,10],[19,24],[11,20],[3,18],[6,25],[11,13],[13,15],[22,24],[6,24],[17,20],[2,25],[15,24],[8,21],[14,16],[5,16],[19,23],[1,5],[4,22],[19,20],[12,15],[16,18],[9,13],[13,22],[14,22],[2,8],[3,13],[9,23],[14,15],[14,17],[8,20],[9,17],[3,19],[8,25],[2,12],[7,24],[19,25],[1,13],[6,11],[14,21],[7,15],[3,14],[15,23],[10,17],[4,20],[6,14],[10,21],[2,13],[3,21],[8,11],[5,21],[6,23],[17,25],[16,21],[12,22],[1,16],[6,19],[7,25],[3,23],[11,25],[3,10],[6,7],[2,3],[5,25],[1,6],[4,17],[2,16],[13,17],[17,22],[6,13],[5,6],[4,11],[4,23],[4,8],[12,23],[7,21],[5,20],[3,24],[2,10],[13,14],[11,24],[1,3],[2,7],[7,23],[6,17],[5,17],[16,17],[8,15],[8,23],[7,17],[14,18],[16,23],[23,24],[4,12],[17,19],[5,
